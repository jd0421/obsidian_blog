---
{"dg-publish":true,"permalink":"/public/course/course-datarian//","tags":["Extract","to_char","timestamp"],"created":"2025-08-26T16:38:19.739+09:00","updated":"2025-08-29T16:08:45.900+09:00"}
---

https://solvesql.com/problems/law-of-the-vital-few/
timestamp면 filter 조건을 반드시 timestamp 형식으로 기입하여 진행하기
  where order_purchase_timestamp between '2018-01-01 00:00:00' and '2018-01-31 23:59:59'

```mysql
with step1 as (

  select

    product_id

    , sum(price) as total_price

  from olist_orders_dataset

    inner join olist_order_items_dataset on olist_orders_dataset.order_id = olist_order_items_dataset.order_id

  where order_purchase_timestamp between '2018-01-01 00:00:00' and '2018-01-31 23:59:59'

  group by 1

  order by 2 desc

)

  

, step2 as (

  select

    *

    , sum(total_price) over(order by total_price desc) / sum(total_price) over() * 100 as portion

  from step1

)

  

select

  case when portion <= 80 then 'Vital Few' else 'Trivial Many' end as `pareto`

  , count(*) as `product_cnt`

from step2

group by 1

  

-- limit 10

;
```
